{#
Copyright (C) 2015 Google Inc., authors, and contributors <see AUTHORS file>
Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
Created By: miha@reciprocitylabs.com
Maintained By: miha@reciprocitylabs.com
#}
  {% import 'notifications/style.html' as style %}
  {% import 'notifications/macros.html' as macro %}
  <table {{ style.body_wrap() }} >
    <tr>
      <td {{ style.container() }} >
        <div {{ style.content() }} >
          <table {{ style.table_full() }} >
            <tr>
              <td>
                <h1 {{ style.main_title() }} >
                  Hi, {{ macro.user_name(digest['user']) }}.
                </h1>

                {% if digest['task_overdue'] %}
                  <h2 {{ style.sub_title() }} >
                    {%  if digest['task_overdue']|length > 1 %}
                      You have overdue tasks task in gGRC:
                    {% else %}
                      You have an overdue task in gGRC:
                    {% endif %}
                  </h2>
                  <ul {{ style.list_wrap() }} >
                  {% for task in digest['task_overdue'].values() %}
                    <li {{ style.list_item() }} >
                      <a href="{{ task['cycle_task_url'] }}" {{ style.link_text() }} >
                      {{ task['title'] }}</a>{{ " - %s" % task['object_title'] if task['object_title'] }}
                    </li>
                  {% endfor %}
                  </ul>
                {% endif %}

                {% if digest['task_declined'] %}
                  <h2 {{ style.sub_title() }} >
                    {% if digest['task_declined']|length > 1 %}
                      Your finished tasks were declined - please review them:
                    {% else %}
                      Your finished task was declined - please review it:
                    {% endif %}
                  </h2>
                  <ul {{ style.list_wrap() }} >
                  {% for task in digest['task_declined'].values() %}
                    <li {{ style.list_item() }} >
                      <a href="{{ task['cycle_task_url'] }}" {{ style.link_text() }} >
                      {{ task['title'] }}</a>{{ " - %s" % task['object_title'] if task['object_title'] }}
                    </li>
                  {% endfor %}
                {% endif %}

                {% if digest['due_soon'] %}
                  <h2 {{ style.sub_title() }} >
                    {% if digest['due_soon']|length == 1 %}
                      You have a task that needs to be completed soon:
                    {% else %}
                      You have {{ digest['due_soon']|length }} tasks that need to be completed soon:
                    {% endif %}
                  </h2>
                  <ul {{ style.list_wrap() }} >
                  {% for task in digest['due_soon'].values() %}
                    <li {{ style.list_item() }} >
                      <a href="{{ task['cycle_task_url'] }}" {{ style.link_text() }} >
                      {{ task['title'] }}</a>{{ " - %s" % task['object_title'] if task['object_title'] }},
                    due {{ task['fuzzy_due_in'] }}
                    </li>
                  {% endfor %}
                  </ul>
                {% endif %}

                {% if digest['cycle_started_tasks'] %}
                  <h2 {{ style.sub_title() }} >
                    {% if digest['cycle_started_tasks']|length > 1 %}
                      You have been assigned these tasks:
                    {% else %}
                      You have been assigned a task:
                    {% endif %}
                  </h2>
                  <ul {{ style.list_wrap() }} >
                  {% for task in digest['cycle_started_tasks'].values() %}
                    <li {{ style.list_item() }} >
                      <a href="{{ task['cycle_task_url'] }}" {{ style.link_text() }} >
                        {{ task['title'] }}</a>{{ " - %s" % task['object_title'] if task['object_title'] }},
                        due on {{ task['end_date'] }}
                    </li>
                  {% endfor %}
                {% endif %}

                {% if digest['cycle_started'] %}
                  <h2 {{ style.sub_title() }} >
                    {% if digest['cycle_started']|length > 1 %}
                      These workflows just started:
                    {% else %}
                      This workflow just started:
                    {% endif %}
                  </h2>
                  <ul {{ style.list_wrap() }} >
                  {% for cycle_id, cycle in digest['cycle_started'].items() %}
                    <li {{ style.list_item() }} >
                      New cycle of
                      <a href="{{ cycle['cycle_url'] }}" {{ style.link_text() }} >{{ cycle['cycle_title'] }}</a>.
                    </li>
                  {% endfor %}
                  </ul>
                {% endif %}

                {% if digest['all_tasks_completed'] %}
                  <h2 {{ style.sub_title() }} >
                    {% if digest['all_tasks_completed']|length > 1 %}
                      All tasks have been completed in these workflow cycles
                    {% else %}
                      All tasks have been completed in this workflow cycle
                    {% endif %}
                    </h2>
                  <ul {{ style.list_wrap() }} >
                  {% for cycle_id, cycle in digest['all_tasks_completed'].items() %}
                    <li {{ style.list_item() }} >
                      Completed cycle of
                      <a href="{{ cycle['cycle_url'] }}" {{ style.link_text() }} >{{ cycle['cycle_title'] }}</a>.
                    </li>
                  {% endfor %}
                  </ul>
                {% endif %}

                {% if digest['cycle_starts_in'] %}
                  <h2 {{ style.sub_title() }} >
                    {% if digest['cycle_starts_in']|length > 1 %}
                      These workflows are starting soon:
                    {% else %}
                      This workflow is starting soon:
                    {% endif %}
                  </h2>
                  <ul {{ style.list_wrap() }} >
                  {% for workflow_id, workflow in digest['cycle_starts_in'].items() %}
                    <li {{ style.list_item() }} >
                      New cycle of
                      <a href="{{ workflow['workflow_url'] }}" {{ style.link_text() }} >
                        {{ workflow['title'] }}</a>
                      starts {{ workflow['fuzzy_start_date'] }}.
                    </li>
                  {% endfor %}
                  </ul>
                {% endif %}

                <p {{ style.text_paragraph() }} >
                  If you have any questions, please contact your gGRC administrator
                </p>
              </td>
            </tr>
          </table>
        </div>
      </td>
    </tr>
  </table>
