{{!
    Copyright (C) 2015 Google Inc., authors, and contributors <see AUTHORS file>
    Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
    Created By: ivan@reciprocitylabs.com
    Maintained By: ivan@reciprocitylabs.com
}}

<section class="info sticky-info-panel" style="height: 311px !important;">

  <div class="pane-header">
    <div class="row-fluid wrap-row">
      <div class="span9">
        <h6>Title</h6>
        <h3>{{info_title}}</h3>
        <span class="state-value state-{{state_color}}">{{state}}</span>
      </div>
      <div class="span3">
        <div class="info-pane-utility">

          <div class="details-wrap pin">
            <ul class="pin-action">
              <li>
                <a href="javascript://" data-size="min" class="min"><i class="grcicon-minimize" rel="tooltip" data-placement="left" title="Minimize height"></i></a>
              </li>
              <li>
                <a href="javascript://" data-size="normal" class="normal"><i class="grcicon-default" style="opacity:1.0" rel="tooltip" data-placement="left" title="Default height"></i></a>
              </li>
              <li>
                <a href="javascript://" data-size="max" class="max"><i class="grcicon-maximize" rel="tooltip" data-placement="left" title="Maximize height"></i></a>
              </li>
              <li>
                <a href="javascript://" data-size="deselect" class="close-pane"><i class="grcicon-x-grey" rel="tooltip" data-placement="left" title="Close info pane"></i></a>
              </li>
            </ul><!-- pin-action end -->
          </div><!-- details-wrap pin end -->

          <div class="details-wrap">
            <a class="btn btn-small btn-draft dropdown-toggle" href="#" data-toggle="dropdown">
              <span class="bubble"></span>
              <span class="bubble"></span>
              <span class="bubble"></span>
            </a>
            <ul class="dropdown-menu" aria-labelledby="drop1" role="menu">
              {{#is_allowed 'update' instance context='for'}}
                {{> /static/mustache/base_objects/edit_object_link.mustache}}
              {{/is_allowed}}
              <li>
                <clipboard-link title="Get permalink" notify="true" text="{{get_permalink}}" />
              </li>

              {{#is_info_pin}}
                {{#is_allowed_to_map page_instance instance}}
                  {{^options.is_in_selector}}
                    {{> /static/mustache/base_objects/unmap.mustache}}

                  {{/options}}
                {{/is_allowed_to_map}}
                {{#if instance.viewLink}}
                  {{#is_allowed "view_object_page" instance}}
                    <li>
                      <a href="{{instance.viewLink}}">
                        <i class="grcicon-goto"></i>
                        View {{instance.class.title_singular}}
                      </a>
                    </li>
                  {{/is_allowed}}
                {{/if}}
              {{/is_info_pin}}

              {{#is_allowed 'delete' instance}}
                <li>
                  <a data-toggle="modal-ajax-deleteform" data-object-plural="{{model.table_plural}}" data-object-singular="{{model.model_singular}}" data-modal-reset="reset" data-modal-class="modal" data-object-id="{{instance.id}}" href="javascript://">
                    <i class="grcicon-deleted"></i>
                    Delete
                  </a>
                </li>
              {{/is_allowed}}

            </ul>
          </div>

          <a href="javascript://" class="btn-complete btn btn-small btn-primary pull-right">Complete</a>
        </div>
      </div>
    </div>
  </div>

  <div class="tier-content">
    <div class="row-fluid">
      <div class="span8">

        <div class="row-fluid wrap-row">
          <div class="span12">
            <h6>Description</h6>
            <div class="rtf-block">
              {{description}}
            </div>
          </div>
        </div>

        <div class="row-fluid wrap-row">
          <div class="span6">
            <attachment-list title="Evidence" data="comments" types="!url"></attachment-list>
          </div>
          <div class="span6">
            <attachment-list title="URL" data="comments" types="url"></attachment-list>
          </div>
        </div>

        <div class="row-fluid wrap-row">
          <div class="span12">
            <h6>Mapped objects</h6>
            <ul class="mapped-list">
              {{#mapped_objects}}
                <li>
                  <div class="custom-attr-wrap mapped">
                    <div class="row-fluid">
                      <div class="span12">
                        <div class="info-expand">
                          <a class="show-hidden-fields info-show-hide" href="javascript://">
                            <span class="out">
                              <i class="grcicon-arrow-right"></i>
                            </span>
                            <span class="in">
                              <i class="grcicon-arrow-bottom"></i>
                            </span>
                            <i class="grcicon-{{icon}}-color"></i>
                            {{title}}
                          </a>
                        </div>
                      </div>
                    </div><!-- row-fluid end -->
                    <div class="hidden-fields-area" style="display:none;">
                      <div class="row-fluid wrap-row">
                        <div class="span12">
                          <h6>Description</h6>
                          {{description}}
                        </div>
                      </div><!-- row-fluid end -->
                    </div><!-- hidden-fields-area end -->
                  </div>
                </li>
              {{/mapped_objects}}
            </ul>
            <a class="btn btn-draft btn-small" href="javascript://">
              Map objects
            </a>
          </div>
        </div>

      </div>
      <div class="span4">

        <div class="row-fluid wrap-row">
          <div class="span12">
            <h6>People</h6>
            <div class="side-content">
              <ul class="label-list">
                <li>
                  <label>
                    <span class="person-label {{type_a}}"></span>
                    Assignee
                  </label>
                  <ul>
                    {{#people_assignee}}
                      <li>
                        <span class="file-controls">
                          <a href="javascript://"><i class="grcicon-deleted"></i></a>
                          <a href="javascript://"><i class="grcicon-edit"></i></a>
                        </span>
                        <a href="javascript://">{{name}}</a>
                      </li>
                    {{/people_assignee}}
                  </ul>
                </li>
                <li>
                  <label>
                    <span class="person-label {{type_r}}"></span>
                    Requester
                  </label>
                  <ul>
                    {{#people_requester}}
                      <li>
                        <span class="file-controls">
                          <a class="disabled" href="javascript://"><i class="grcicon-deleted"></i></a>
                          <a href="javascript://"><i class="grcicon-edit"></i></a>
                        </span>
                        <a href="javascript://">{{name}}</a>
                      </li>
                    {{/people_requester}}
                  </ul>
                </li>
                <li>
                  <label>
                    <span class="person-label {{type_v}}"></span>
                    Verifier
                  </label>
                  <ul>
                    {{#people_verifier}}
                      <li>
                        <span class="file-controls">
                          <a href="javascript://"><i class="grcicon-deleted"></i></a>
                          <a href="javascript://"><i class="grcicon-edit"></i></a>
                        </span>
                        <a href="javascript://">{{name}}</a>
                      </li>
                    {{/people_verifier}}
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="row-fluid wrap-row">
          <div class="span12">
            <h6>Dates</h6>
            <div class="side-content">
              <ul class="label-list dates">
                <li class="gray">
                  <label>
                    Created on
                  </label>
                  {{created_on}}
                </li>
                <li>
                  <span class="file-controls">
                    <a href="javascript://"><i class="grcicon-edit"></i></a>
                  </span>
                  <label>
                    Due on
                  </label>
                  {{due_on}}
                </li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="tabs-wrap">
      <ul class="nav nav-tabs">
        <li class="active"><a href="#tab1" data-toggle="tab">
          Comments and Responses ({{comments.length}})
        </a></li>
        <li><a href="#tab2" data-toggle="tab">
          Request log
        </a></li>
        <li><a href="#tab3" data-toggle="tab">
          Related responses
        </a></li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade in active" id="tab1">
          <div class="tree-item-add">
            <add-comment data="comments"></add-comment>
          </div>
          <ul class="entry-list">
            {{#comments}}
              <li>
                <span class="person-label {{type}}"></span>
                <div class="w-status">
                  <span class="entry-author">
                    {{#author}}
                      <a href="javascript://">{{name}}</a>
                    {{/author}}
                    added a response - {{timestamp}}
                  </span>
                  {{comment}}
                  <ul class="attachment-list">
                    {{#attachments}}
                      <li>
                        <span class="file-controls">
                          <a href="javascript://"><i class="grcicon-deleted"></i></a>
                          <a href="javascript://"><i class="grcicon-edit"></i></a>
                        </span>
                        <i class="grcicon-file{{#icon}}-{{icon}}{{/icon}}"></i>
                        <a href="{{url}}" target="_blank">
                          {{name}}
                        </a>
                      </li>
                    {{/attachments}}
                  </ul>
                </div>
              </li>
            {{/comments}}
          </ul>
        </div>
        <div class="tab-pane fade" id="tab2">
          <ul class="entry-list">
            {{#logs}}
              <li>
                <span class="person-label {{type}}"></span>
                <div class="w-status">
                  <span class="entry-author">
                    <a href="javascript://">{{author}}</a>
                    {{log_status}} - {{timestamp}}
                  </span>
                  <div class="clearfix">
                    <div class="third-col">
                      <p class="instruction">Field</p>
                      {{field}}
                    </div>
                    <div class="third-col">
                      <p class="instruction">Original value</p>
                      {{#original_value}}
                        {{text}}
                        <ul class="attachment-list">
                          {{#file_list}}
                          <li class="oneline">
                            <i class="grcicon-file{{#icon}}-{{icon}}{{/icon}}"></i>
                            {{name}}
                          </li>
                          {{/file_list}}
                        </ul>
                      {{/original_value}}
                    </div>
                    <div class="third-col">
                      <p class="instruction">New value</p>
                      {{#new_value}}
                        {{text}}
                        <ul class="attachment-list">
                          {{#file_list}}
                          <li class="oneline">
                            <i class="grcicon-file{{#icon}}-{{icon}}{{/icon}}"></i>
                            {{name}}
                          </li>
                          {{/file_list}}
                        </ul>
                      {{/new_value}}
                    </div>
                  </div>
                </div>
              </li>
            {{/logs}}
          </ul>
        </div>

        <div class="tab-pane fade" id="tab3">
          <ul class="past-items-list">
            <li class="clearfix list-title">
              <div class="mini-col">
                <h6>Date</h6>
              </div>
              <div class="xmedium-col">
                <h6>Request title</h6>
              </div>
              <div class="small-col">
                <h6>Mapped objects</h6>
              </div>
              <div class="medium-col">
                <h6>Evidence</h6>
              </div>
              <div class="mini-col">
                <a href="javascript://" class="btn btn-small btn-full btn-draft js-trigger-reuse">Reuse</a>
              </div>
            </li>
            {{#past_requests}}
              <li class="clearfix">
                <div class="mini-col">
                  {{timestamp}}
                </div>
                <div class="xmedium-col">
                  <a target="_blank" href="javascript://">
                    {{title}}
                  </a>
                </div>
                <div class="small-col">
                  <ul class="mapped-list">
                    {{#mapped_objects}}
                      <li>
                        <i class="grcicon-{{icon}}-color"></i>
                        <span class="person-holder">
                          <a href='mailto:{{email}}' target="_blank">
                            <span class="person-tooltip-trigger" data-placement="top">
                              {{title}}
                            </span>
                          </a>

                          <div class="custom-popover-content">
                            <div class="preview-container person-preview">
                              <div class="row-fluid">
                                <div class="span12">
                                  <div class="profile-info">
                                    <div class="row-fluid wrap-row">
                                      <div class="span8">
                                        <h6>Title</h6>
                                        <h5 class="oneline"><i class="grcicon-{{icon}}-color"></i> {{title}}</h5>
                                      </div>
                                      <div class="span4">
                                        <h6>Status</h6>
                                        {{state}}
                                      </div>
                                    </div>
                                    <div class="row-fluid wrap-row">
                                      <div class="span12">
                                        <h6>Description</h6>
                                        {{description}}
                                      </div>
                                    </div>

                                    {{{render '/static/mustache/base_objects/contacts.mustache' instance=instance}}}

                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </span>
                      </li>
                    {{/mapped_objects}}
                  </ul>
                </div>
                <div class="large-col">
                  <ul class="attachment-list">
                    {{#each files}}
                      <li>
                        <label>
                          <i class="grcicon-file{{#icon}}-{{icon}}{{/icon}}"></i>
                          {{name}}
                        </label>
                        <input type="checkbox" class="js-trigger-pastfile" {{{data "item"}}}>
                      </li>
                    {{/files}}
                  </ul>
                </div>
              </li>
            {{/past_requests}}
          </ul>
        </div>

      </div>
    </div>

  </div><!-- tier-content end -->

</section>
